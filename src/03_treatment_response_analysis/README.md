## Treatment Response Analysis
# Treatment Response Analysis

Longitudinal analysis of PACC (Preclinical Alzheimer's Cognitive Composite) trajectories in response to Solanezumab treatment, stratified by AD subtype (W1 / W2).

---

## Overview

This module fits a **Generalized Least Squares (GLS)** model with **natural cubic splines** and **CAR(1) within-subject correlation** to assess differential treatment effects across Alzheimer's disease subtypes. The approach follows the methodology described in Carolyn et al.

**Key questions:**
- Do W1 and W2 subtypes show different rates of cognitive decline?
- Does Solanezumab differentially benefit one subtype over the other?

---

## Model Specification

```
PACC ~ ns(T_weeks, df=3) × Group + age + sex + education + race + APOE-ε4 + amyloid + baseline_PACC
```

| Component | Choice | Rationale |
|-----------|--------|-----------|
| Time function | Natural cubic splines, df = 3 | Flexible nonlinear trajectory; df selected by AIC |
| Group | Subtype × Treatment interaction | Tests differential drug response by subtype |
| Correlation | CAR(1) | Continuous-time AR(1) for unequally spaced visits |
| Covariates | Age, sex, education, race, APOE-ε4, baseline amyloid (SUVRCER), baseline PACC | Standard AD trial adjustment set |

---

## File Structure

```
03_treatment_response_analysis/
├── gls_treatment_response.R   # Main analysis script
└── README.md

# Required data (not tracked by git — see Data section below):
data/
├── PACC.csv
├── SUBJINFO.csv
└── Brainplotk=2.csv

# Outputs (generated by script):
outputs/
├── figures/
│   ├── PACC_gls_natural_spline.png
│   ├── PACC_gls_df3_CI.png
│   ├── PACC_gls_df4_CI.png
│   ├── PACC_gls_df3_PredictionInterval.png
│   ├── PACC_gls_bootstrap_CI.png
│   └── PACC_gls_bootstrap_CI_publication.pdf
└── boot_summary.rds
```

---

## Data

Raw data files are **not included** in this repository (participant-level clinical trial data, access-restricted).

Required files and expected columns:

| File | Key columns |
|------|-------------|
| `PACC.csv` | `BID`, `VISCODE`, `PACC` |
| `SUBJINFO.csv` | `BID`, `TX`, `AGEYR`, `SEX`, `EDCCNTU`, `RACE`, `SUVRCER`, `AMYLCENT`, `APOEGN`, `APOEGNPRSNFLG` |
| `Brainplotk=2.csv` | `SubjectID`, `Subtype` (values: `S1`, `S2`) |

---

## Requirements

```r
install.packages(c("dplyr", "tidyr", "nlme", "splines",
                   "ggplot2", "ggthemes", "patchwork", "cowplot", "boot"))
```

R version ≥ 4.1.0 recommended.

---

## How to Run

1. Place the three data files in `data/` at the repo root.
2. Open `gls_treatment_response.R` and confirm the relative paths at the top match your directory layout.
3. Source the script:

```r
source("src/03_treatment_response_analysis/gls_treatment_response.R")
```

Figures are saved to `outputs/figures/`. The bootstrap step (n = 5000) takes approximately 30–60 minutes depending on your machine.

---

## Output Description

| Figure | Description |
|--------|-------------|
| `PACC_gls_natural_spline.png` | Model trajectories, no uncertainty band |
| `PACC_gls_df3_CI.png` | df=3 with delta-method 95% CI |
| `PACC_gls_df4_CI.png` | df=4 with delta-method 95% CI |
| `PACC_gls_df3_PredictionInterval.png` | df=3 with 95% prediction interval (includes residual variance) |
| `PACC_gls_bootstrap_CI_publication.pdf` | Publication-ready figure, bootstrap CI, split by subtype |

---

## Notes

- Bootstrap uses **cluster resampling** (resample whole patients) to preserve within-subject correlation.
- Failed bootstrap iterations (non-convergence) are silently skipped; convergence rate is reported in console output.
- Subtype labels: **W1** = S1 (Typical pattern), **W2** = S2 (Cortical pattern).
